<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">

<ui:composition template="../templates/common.xhtml">

	<ui:define name="body">

		<h:form id="form" enctype="multipart/form-data">

			<p:panel style="width:100%;height:100%;"
				header="#{historyBacking.title}">

				<p:spacer height="5" />

				<p:poll rendered="#{not historyBacking.modeEdit}"
					update="selectedTable" interval="60"
					listener="#{historyBacking.refreshAction}" />

				<p:growl id="growl" showDetail="true" />

				<p:toolbar id="toolBarPatient" style="width:100%"
					rendered="#{not historyBacking.modeEdit or historyBacking.modeHistorial}">
					<p:toolbarGroup align="left">
						<p:commandButton value="#{msg['btn_refresh']}"
							icon="ui-icon-arrowrefresh-1-s" update="form"
							action="#{historyBacking.refreshAction}"
							rendered="#{not historyBacking.modeEdit and not historyBacking.modeHistorial}" />
						<p:commandButton id="btnSelectPatient"
							value="#{msg['btn_add_patient']}" icon="ui-icon-circle-check"
							oncomplete="dlgPatient.show()" update="dialogPatient" />
						<p:commandButton icon="ui-icon-arrowreturnthick-1-w"
							value="#{msg['btn_return']}" update="form"
							rendered="#{historyBacking.modeHistorial}" immediate="true">
							<f:setPropertyActionListener value="false"
								target="#{historyBacking.modeEdit}" />
						</p:commandButton>
					</p:toolbarGroup>
				</p:toolbar>

				<p:spacer
					rendered="#{not historyBacking.modeEdit or historyBacking.modeHistorial}" />

				<!-- TACTU CITAS -->
				<h:panelGrid id="tblAppointment" columns="1" width="100%"
					rendered="#{not historyBacking.modeEdit}">
					<p:dataTable id="selectedTable" var="rec"
						value="#{historyBacking.appointmentModel}" rowKey="#{rec.code}"
						style="width:100%" paginator="true" rows="10"
						emptyMessage="#{msg['glb_no_records_found_check']}">

						<f:facet name="header">
							#{msg['app_avalaible']}
						</f:facet>

						<p:column headerText="#{msg['app_date']}">
							<h:outputLabel value="#{rec.startAppointmentDate}">
								<f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
							</h:outputLabel>
						</p:column>

						<p:column headerText="#{msg['pat_surnames']}"
							filterBy="#{rec.patSurnames}" filterMatchMode="contains">
							<h:outputLabel value="#{rec.patSurnames}" />
						</p:column>

						<p:column headerText="#{msg['pat_names']}"
							filterBy="#{rec.patFirstnames}" filterMatchMode="contains">
							<h:outputLabel value="#{rec.patFirstnames}" />
						</p:column>

						<p:column headerText="#{msg['app_branch']}">
							<h:outputLabel value="#{rec.branchName}" />
						</p:column>

						<p:column headerText="#{msg['app_procedure']}">
							<h:outputLabel value="#{rec.prcDetName}" />
						</p:column>

						<p:column headerText="#{msg['pat_type_obs']}" style="width:100px">
							<h:inputTextarea rows="3" style="width:200px" value="#{rec.obs}"
								readonly="true" />
						</p:column>

						<p:column style="width:4%">
							<p:commandButton icon="ui-icon-check"
								title="#{msg['btn_assisted_appointment']}" update=":form"
								action="#{historyBacking.editAppointmentAction}" process="@this">
								<f:setPropertyActionListener value="#{rec}"
									target="#{historyBacking.selectedAppointment}" />
							</p:commandButton>
						</p:column>

					</p:dataTable>
				</h:panelGrid>

				<!-- TACTU CITAS -->
				<h:panelGrid id="tblPart" columns="1" width="100%"
					rendered="#{historyBacking.modeEdit}">

					<p:toolbar id="toolBar" style="width:100%"
						rendered="#{not historyBacking.modeHistorial}">
						<p:toolbarGroup align="left">
							<p:commandButton icon="ui-icon-disk" value="#{msg['btn_save']}"
								update="form" actionListener="#{historyBacking.saveAction}"
								disabled="#{historyBacking.currentAppointment.closeAppointment}"
								process="@this, toolBar, accordion" />
							<p:commandButton value="#{msg['btn_close_appointment']}"
								icon="ui-icon-locked" onclick="confirmation.show()"
								disabled="#{historyBacking.currentAppointment.closeAppointment}"
								process="@this, accordion"
								rendered="#{historyBacking.rolePrincipal eq 'DOCTOR' or historyBacking.rolePrincipal eq 'CONSULTANT'}" />
							<p:commandButton icon="ui-icon-bookmark"
								value="#{msg['btn_view_history']}" update="form"
								oncomplete="dlgHistorial.show()"
								process="@this, toolBar, accordion" />
							<p:commandButton
								disabled="#{not historyBacking.currentAppointment.closeAppointment}"
								icon="ui-icon-print"
								rendered="#{historyBacking.rolePrincipal eq 'DOCTOR' or historyBacking.rolePrincipal eq 'CONSULTANT'}"
								value="#{msg['btn_print_medication']}" ajax="false"
								action="#{historyBacking.printFormulaAction}"
								process="@this,toolBar" />
							<p:commandButton
								disabled="#{not historyBacking.currentAppointment.closeAppointment}"
								icon="ui-icon-print"
								rendered="#{historyBacking.rolePrincipal eq 'DOCTOR' and historyBacking.currentAppointment.medicationTherapy}"
								value="#{msg['btn_print_therapy']}" ajax="false"
								action="#{historyBacking.printFormulaTherapyAction}"
								process="@this, toolBar, accordion" />
							<p:commandButton
								disabled="#{not historyBacking.currentAppointment.closeAppointment}"
								icon="ui-icon-print"
								rendered="#{historyBacking.rolePrincipal eq 'DOCTOR' and historyBacking.currentAppointment.recommendations ne null and not empty historyBacking.currentAppointment.recommendations}"
								value="#{msg['btn_print_recommendations']}" ajax="false"
								action="#{historyBacking.printRecommendationsAction}"
								process="@this, toolBar, accordion" />
							<p:commandButton
								disabled="#{not historyBacking.currentAppointment.closeAppointment}"
								icon="ui-icon-print"
								rendered="#{historyBacking.rolePrincipal eq 'DOCTOR' and not historyBacking.disabledExam}"
								value="#{msg['btn_print_lab']}" ajax="false"
								action="#{historyBacking.printFormulaLabAction}"
								process="@this, toolBar, accordion" />
							<p:commandButton icon="ui-icon-arrowreturnthick-1-w"
								value="#{msg['btn_return']}" update="form"
								process="@this, toolBar, accordion">
								<f:setPropertyActionListener value="false"
									target="#{historyBacking.modeEdit}" />
							</p:commandButton>
						</p:toolbarGroup>
					</p:toolbar>

					<p:spacer rendered="#{not historyBacking.modeHistorial}" />

					<p:panelGrid id="pnlPatient" columns="4" style="width:100%">

						<f:facet name="header">
							<h:outputLabel value="#{msg['pat']}" />
						</f:facet>

						<h:outputLabel value="#{msg['pat_sap_code']}"
							rendered="#{historyBacking.selectedPatient.id eq null?false:true}" />
						<p:inputText value="#{historyBacking.selectedPatient.codeSap}"
							style="width:400px;background-color:#FFFF80;font-weight:bold;"
							readonly="true"
							rendered="#{historyBacking.selectedPatient.id eq null?false:true}" />

						<h:outputLabel value="#{msg['pat_code']}"
							rendered="#{historyBacking.selectedPatient.id eq null?false:true}" />
						<p:inputText value="#{historyBacking.selectedPatient.doc}"
							style="width:400px;background-color:#FFFF80;font-weight:bold;"
							readonly="true"
							rendered="#{historyBacking.selectedPatient.id eq null?false:true}" />

						<h:outputLabel value="#{msg['pat_names']}"
							rendered="#{historyBacking.selectedPatient.id eq null?false:true}" />
						<p:inputText value="#{historyBacking.selectedPatient.names}"
							style="width:400px;background-color:#FFFF80;font-weight:bold;"
							readonly="true"
							rendered="#{historyBacking.selectedPatient.id eq null?false:true}" />

						<h:outputLabel value="#{msg['glb_gender']}"
							rendered="#{historyBacking.selectedPatient.id eq null?false:true}" />
						<p:inputText
							style="width:400px;background-color:#FFFF80;font-weight:bold;"
							readonly="true"
							rendered="#{historyBacking.selectedPatient.id eq null?false:true}"
							value="#{historyBacking.selectedPatient.gender eq 'W'?msg['glb_gender_woman']:historyBacking.selectedPatient.gender eq 'M'?msg['glb_gender_man']:''}" />

						<h:outputLabel value="#{msg['pat_age']}"
							rendered="#{historyBacking.selectedPatient.id eq null?false:true}" />
						<p:inputText
							style="width:400px;background-color:#FFFF80;font-weight:bold;"
							readonly="true"
							rendered="#{historyBacking.selectedPatient.id eq null?false:true}"
							value="#{historyBacking.selectedPatient.age}" />

					</p:panelGrid>

					<p:spacer />

					<p:accordionPanel id="accordion" style="width:1100px;height:100%"
						activeIndex="#{historyBacking.activeIndex}"
						rendered="#{not historyBacking.modeHistorial}">

						<p:ajax event="tabChange"
							listener="#{historyBacking.handleTabChange}"
							update=":form:accordion:tblStudyCase" />

						<p:tab title="#{msg['title_patient_complementary']}"
							id="PATIENT_COMPLEMENTARY">

							<p:fieldset legend="#{msg['pat_personal_data']}">
								<h:panelGrid id="pnlDetail" columns="4" style="margin:0 auto;"
									width="100%">

									<h:outputLabel value="#{msg['pat_born_date']}" />
									<p:calendar value="#{historyBacking.selectedPatient.bornDate}"
										label="#{msg['pat_born_date']}" readonlyInput="false"
										pattern="dd/MM/yyyy" showOn="button" navigator="true"
										locale="es" yearRange="-100:+0"
										maxdate="#{historyBacking.maxDate}">
										<f:convertDateTime pattern="dd/MM/yyyy" />
										<p:ajax event="dateSelect"
											listener="#{historyBacking.handleBornDateSelect}"
											update="txtAge pnlGender" />
									</p:calendar>

									<h:outputLabel value="#{msg['pat_age']}" />
									<p:inputText id="txtAge"
										style="width:400px;background-color:#FFFF80;font-weight:bold;"
										readonly="true"
										value="#{historyBacking.age} #{msg['glb_age']}" />

									<h:outputLabel value="#{msg['pat_marital_state']}" />
									<p:selectOneMenu style="width:408px"
										value="#{historyBacking.selectedPatient.idMaritalState}"
										label="#{msg['pat_marital_state']}">
										<f:selectItem itemLabel="#{msg['glb_default_value']}"
											noSelectionOption="true" />
										<f:selectItems value="#{historyBacking.listMaritalStatus}" />
									</p:selectOneMenu>

									<h:outputLabel value="#{msg['pat_occupation']}" />
									<p:selectOneMenu value="#{historyBacking.idOccupation}"
										style="width:408px" label="#{msg['pat_occupation']}">
										<f:selectItems value="#{historyBacking.listOccupation}" />
									</p:selectOneMenu>

									<h:outputLabel value="#{msg['pat_eps']}" style="width:40%" />
									<p:selectOneMenu
										value="#{historyBacking.selectedPatient.idEps}"
										label="#{msg['pat_eps']}" style="width:408px" filter="true"
										filterMatchMode="contains">
										<f:selectItem itemLabel="#{msg['glb_default_value']}"
											noSelectionOption="true" />
										<f:selectItems value="#{patientBacking.listEps}" />
										<p:ajax update="somMemberShip"
											listener="#{historyBacking.cleanMemberShip}" />
									</p:selectOneMenu>

									<h:outputLabel value="#{msg['pat_membership_type']}"
										style="width:40%" />
									<p:selectOneMenu id="somMemberShip"
										value="#{historyBacking.selectedPatient.idMemberShip}"
										label="#{msg['pat_membership_type']}" style="width:408px"
										disabled="#{historyBacking.selectedPatient.idEps eq -1}">
										<f:selectItem itemLabel="#{msg['glb_default_value']}"
											noSelectionOption="true" />
										<f:selectItems value="#{patientBacking.listMembershipType}" />
									</p:selectOneMenu>

									<h:outputLabel value="#{msg['pat_neighborhood']}" />
									<p:inputText style="width:400px"
										label="#{msg['pat_neighborhood']}"
										value="#{historyBacking.neighborhood}" />

									<h:outputLabel value="#{msg['pat_type_housing']}" />
									<p:selectOneMenu value="#{historyBacking.typeHousing}"
										style="width:408px" label="#{msg['pat_type_housing']}">
										<f:selectItem itemLabel="#{msg['glb_default_value']}"
											itemValue="" />
										<f:selectItem itemLabel="#{msg['pat_type_housing_u']}"
											itemValue="U" />
										<f:selectItem itemLabel="#{msg['pat_type_housing_r']}"
											itemValue="R" />
									</p:selectOneMenu>

								</h:panelGrid>
							</p:fieldset>

						</p:tab>

						<p:tab title="#{msg['his_history_history']}" id="HISTORY"
							rendered="#{historyBacking.rolePrincipal eq 'DOCTOR'}">

							<h:panelGrid id="pnlHistory" columns="1" width="100%"
								cellpadding="10">

								<h:outputText value="#{msg['his_history_reason']}" />
								<p:inputTextarea style="width:1050px" rows="5"
									value="#{historyBacking.selectedHistoryHistory.reason}" />

								<h:outputText value="#{msg['his_history_disease']}" />
								<p:inputTextarea style="width:1050px" rows="5"
									value="#{historyBacking.selectedHistoryHistory.disease}" />

								<h:outputText value="#{msg['his_history_results']}" />
								<p:inputTextarea style="width:1050px" rows="5"
									value="#{historyBacking.selectedHistoryHistory.results}" />

								<p:spacer height="10" />

								<p:panelGrid columns="2" style="width:100%"
									columnClasses="width25per,width75per">

									<f:facet name="header">
										<h:outputLabel value="#{msg['his_history_review']}" />
									</f:facet>

									<h:outputLabel value="#{msg['his_history_head']}" />
									<p:inputTextarea style="width:750px"
										value="#{historyBacking.selectedHistoryHistory.head}" />

									<h:outputLabel value="#{msg['his_history_orl']}" />
									<p:inputTextarea style="width:750px"
										value="#{historyBacking.selectedHistoryHistory.orl}" />

									<h:outputLabel value="#{msg['his_history_cr']}" />
									<p:inputTextarea style="width:750px"
										value="#{historyBacking.selectedHistoryHistory.cr}" />

									<h:outputLabel value="#{msg['his_history_gi']}" />
									<p:inputTextarea style="width:750px"
										value="#{historyBacking.selectedHistoryHistory.gi}" />

									<h:outputLabel value="#{msg['his_history_neuromuscular']}" />
									<p:inputTextarea style="width:750px"
										value="#{historyBacking.selectedHistoryHistory.neuromuscular}" />

									<h:outputLabel value="#{msg['his_history_gu']}" />
									<p:inputTextarea style="width:750px"
										value="#{historyBacking.selectedHistoryHistory.gu}" />

									<h:outputLabel value="#{msg['his_history_psychiatric']}" />
									<p:inputTextarea style="width:750px"
										value="#{historyBacking.selectedHistoryHistory.psychiatric}" />

									<h:outputLabel value="#{msg['his_history_skin']}" />
									<p:inputTextarea style="width:750px"
										value="#{historyBacking.selectedHistoryHistory.skin}" />
								</p:panelGrid>

							</h:panelGrid>

						</p:tab>

						<p:tab title="#{msg['his_history_record']}" id="RECORD"
							rendered="#{historyBacking.rolePrincipal eq 'DOCTOR'}">
							<p:fieldset legend="#{msg['his_record_personal']}">
								<h:panelGrid id="pnlPersonal" columns="3" width="100%">

									<p:selectBooleanCheckbox
										value="#{historyBacking.selectedHistoryRecord.arthritis}"
										itemLabel="#{msg['his_rec_per_arthritis']}">
										<p:ajax update="txtPersonal1 txtPersonal2" />
									</p:selectBooleanCheckbox>

									<p:inputTextarea id="txtPersonal1" style="width:300px" rows="3"
										label="#{msg['his_record_clic_time']}"
										disabled="#{not historyBacking.selectedHistoryRecord.arthritis}"
										value="#{historyBacking.selectedHistoryRecord.arthritisTime}" />

									<p:inputTextarea id="txtPersonal2" style="width:450px" rows="3"
										label="#{msg['his_record_clic_medi']}"
										disabled="#{not historyBacking.selectedHistoryRecord.arthritis}"
										value="#{historyBacking.selectedHistoryRecord.arthritisMedication}" />

									<p:selectBooleanCheckbox
										value="#{historyBacking.selectedHistoryRecord.cancer}"
										itemLabel="#{msg['his_rec_per_cancer']}">
										<p:ajax update="txtPersonal3 txtPersonal4" />
									</p:selectBooleanCheckbox>

									<p:inputTextarea id="txtPersonal3" style="width:300px" rows="3"
										disabled="#{not historyBacking.selectedHistoryRecord.cancer}"
										value="#{historyBacking.selectedHistoryRecord.cancerTime}" />

									<p:inputTextarea id="txtPersonal4" style="width:450px" rows="3"
										disabled="#{not historyBacking.selectedHistoryRecord.cancer}"
										value="#{historyBacking.selectedHistoryRecord.cancerMedication}" />

									<p:selectBooleanCheckbox
										value="#{historyBacking.selectedHistoryRecord.pulmonary}"
										itemLabel="#{msg['his_rec_per_pulmonary']}">
										<p:ajax update="txtPersonal5 txtPersonal6" />
									</p:selectBooleanCheckbox>

									<p:inputTextarea id="txtPersonal5" style="width:300px" rows="3"
										disabled="#{not historyBacking.selectedHistoryRecord.pulmonary}"
										value="#{historyBacking.selectedHistoryRecord.pulmonaryTime}" />

									<p:inputTextarea id="txtPersonal6" style="width:450px" rows="3"
										disabled="#{not historyBacking.selectedHistoryRecord.pulmonary}"
										value="#{historyBacking.selectedHistoryRecord.pulmonaryMedication}" />

									<p:selectBooleanCheckbox
										value="#{historyBacking.selectedHistoryRecord.diabetes}"
										itemLabel="#{msg['his_rec_per_diabetes']}">
										<p:ajax update="txtPersonal7 txtPersonal8" />
									</p:selectBooleanCheckbox>

									<p:inputTextarea id="txtPersonal7" style="width:300px" rows="3"
										disabled="#{not historyBacking.selectedHistoryRecord.diabetes}"
										value="#{historyBacking.selectedHistoryRecord.diabetesTime}" />

									<p:inputTextarea id="txtPersonal8" style="width:450px" rows="3"
										disabled="#{not historyBacking.selectedHistoryRecord.diabetes}"
										value="#{historyBacking.selectedHistoryRecord.diabetesMedication}" />

									<p:selectBooleanCheckbox
										value="#{historyBacking.selectedHistoryRecord.hypertension}"
										itemLabel="#{msg['his_rec_per_hypertension']}">
										<p:ajax update="txtPersonal9 txtPersonal10" />
									</p:selectBooleanCheckbox>

									<p:inputTextarea id="txtPersonal9" style="width:300px" rows="3"
										disabled="#{not historyBacking.selectedHistoryRecord.hypertension}"
										value="#{historyBacking.selectedHistoryRecord.hypertensionTime}" />

									<p:inputTextarea id="txtPersonal10" style="width:450px"
										rows="3"
										disabled="#{not historyBacking.selectedHistoryRecord.hypertension}"
										value="#{historyBacking.selectedHistoryRecord.hypertensionMedication}" />

									<p:selectBooleanCheckbox
										value="#{historyBacking.selectedHistoryRecord.hospitalizations}"
										itemLabel="#{msg['his_rec_per_hospitalizations']}">
										<p:ajax update="txtPersonal11 txtPersonal12" />
									</p:selectBooleanCheckbox>

									<p:inputTextarea id="txtPersonal11" style="width:300px"
										rows="3"
										disabled="#{not historyBacking.selectedHistoryRecord.hospitalizations}"
										value="#{historyBacking.selectedHistoryRecord.hospitalizationsTime}" />

									<p:inputTextarea id="txtPersonal12" style="width:450px"
										rows="3"
										disabled="#{not historyBacking.selectedHistoryRecord.hospitalizations}"
										value="#{historyBacking.selectedHistoryRecord.hospitalizationsMedication}" />

									<p:selectBooleanCheckbox
										value="#{historyBacking.selectedHistoryRecord.allergy}"
										itemLabel="#{msg['his_rec_per_allergy']}">
										<p:ajax update="txtPersonal13 txtPersonal14" />
									</p:selectBooleanCheckbox>

									<p:inputTextarea id="txtPersonal13" style="width:300px"
										rows="3"
										disabled="#{not historyBacking.selectedHistoryRecord.allergy}"
										value="#{historyBacking.selectedHistoryRecord.allergyTime}" />

									<p:inputTextarea id="txtPersonal14" style="width:450px"
										rows="3"
										disabled="#{not historyBacking.selectedHistoryRecord.allergy}"
										value="#{historyBacking.selectedHistoryRecord.allergyMedication}" />

									<p:selectBooleanCheckbox
										value="#{historyBacking.selectedHistoryRecord.infections}"
										itemLabel="#{msg['his_rec_per_infections']}">
										<p:ajax update="txtPersonal15 txtPersonal16" />
									</p:selectBooleanCheckbox>

									<p:inputTextarea id="txtPersonal15" style="width:300px"
										rows="3"
										disabled="#{not historyBacking.selectedHistoryRecord.infections}"
										value="#{historyBacking.selectedHistoryRecord.infectionsTime}" />

									<p:inputTextarea id="txtPersonal16" style="width:450px"
										rows="3"
										disabled="#{not historyBacking.selectedHistoryRecord.infections}"
										value="#{historyBacking.selectedHistoryRecord.infectionsMedication}" />

								</h:panelGrid>

								<p:watermark value="#{msg['his_record_clic_time']}"
									for="txtPersonal1" />
								<p:watermark value="#{msg['his_record_clic_time']}"
									for="txtPersonal3" />
								<p:watermark value="#{msg['his_record_clic_time']}"
									for="txtPersonal5" />
								<p:watermark value="#{msg['his_record_clic_time']}"
									for="txtPersonal7" />
								<p:watermark value="#{msg['his_record_clic_time']}"
									for="txtPersonal9" />
								<p:watermark value="#{msg['his_record_clic_time']}"
									for="txtPersonal11" />
								<p:watermark value="#{msg['his_record_clic_time']}"
									for="txtPersonal13" />
								<p:watermark value="#{msg['his_record_clic_time']}"
									for="txtPersonal15" />

								<p:watermark value="#{msg['his_record_clic_medi']}"
									for="txtPersonal2" />
								<p:watermark value="#{msg['his_record_clic_medi']}"
									for="txtPersonal4" />
								<p:watermark value="#{msg['his_record_clic_medi']}"
									for="txtPersonal6" />
								<p:watermark value="#{msg['his_record_clic_medi']}"
									for="txtPersonal8" />
								<p:watermark value="#{msg['his_record_clic_medi']}"
									for="txtPersonal10" />
								<p:watermark value="#{msg['his_record_clic_medi']}"
									for="txtPersonal12" />
								<p:watermark value="#{msg['his_record_clic_medi']}"
									for="txtPersonal14" />
								<p:watermark value="#{msg['his_record_clic_medi']}"
									for="txtPersonal16" />

								<p:spacer height="5" />

								<h:panelGrid columns="1" width="100%"
									columnClasses="width25per,width75per">

									<h:outputText value="#{msg['his_rec_per_surgical']}" />
									<p:inputTextarea style="width:950px" rows="3"
										value="#{historyBacking.selectedHistoryRecord.surgical}" />

									<h:outputText value="#{msg['his_rec_per_pharmacological']}" />
									<p:inputTextarea style="width:950px" rows="3"
										value="#{historyBacking.selectedHistoryRecord.pharmacological}" />

									<h:outputText value="#{msg['his_rec_per_toxic']}" />
									<p:inputTextarea style="width:950px" rows="3"
										value="#{historyBacking.selectedHistoryRecord.toxic}" />

									<h:outputText value="#{msg['his_rec_per_occupational']}" />
									<p:inputTextarea style="width:950px" rows="3"
										value="#{historyBacking.selectedHistoryRecord.occupational}" />

									<h:outputText value="#{msg['his_rec_blood_type']}" />
									<p:inputTextarea style="width:950px" rows="3"
										value="#{historyBacking.selectedHistoryRecord.bloodType}" />

									<h:outputText value="#{msg['his_rec_per_immunizations']}" />
									<p:inputTextarea style="width:950px" rows="3"
										value="#{historyBacking.selectedHistoryRecord.immunizations}" />

									<h:outputText value="#{msg['his_rec_per_transfusion']}" />
									<p:inputTextarea style="width:950px" rows="3"
										value="#{historyBacking.selectedHistoryRecord.transfusion}" />

									<h:outputText value="#{msg['his_rec_per_planning']}"
										rendered="#{historyBacking.renderedRecord eq 2?true:false}" />
									<p:inputTextarea style="width:950px" rows="3"
										value="#{historyBacking.selectedHistoryRecord.planning}"
										rendered="#{historyBacking.renderedRecord eq 2?true:false}" />

									<h:outputText value="#{msg['his_rec_per_other']}" />
									<p:inputTextarea style="width:950px" rows="3"
										value="#{historyBacking.selectedHistoryRecord.other}" />
								</h:panelGrid>
							</p:fieldset>

							<h:panelGrid id="pnlGender" width="100%">

								<p:spacer height="5"
									rendered="#{historyBacking.renderedRecord eq 2}" />

								<p:fieldset legend="#{msg['his_record_women']}"
									rendered="#{historyBacking.renderedRecord eq 2}">
									<h:panelGrid columns="4" width="100%"
										columnClasses="width25per,width75per">

										<h:outputText value="#{msg['his_rec_pregnancy']}" />
										<p:inputText style="width:350px"
											value="#{historyBacking.selectedHistoryRecord.pregnancy}" />

										<h:outputText value="#{msg['his_rec_parity']}" />
										<p:inputText style="width:350px"
											value="#{historyBacking.selectedHistoryRecord.parity}" />

										<h:outputText value="#{msg['his_rec_abortions']}" />
										<p:inputText style="width:350px"
											value="#{historyBacking.selectedHistoryRecord.abortions}" />

										<h:outputText value="#{msg['his_rec_caesarean']}" />
										<p:inputText style="width:350px"
											value="#{historyBacking.selectedHistoryRecord.caesarean}" />

										<h:outputText value="#{msg['his_rec_stillbirths']}" />
										<p:inputText style="width:350px"
											value="#{historyBacking.selectedHistoryRecord.stillbirths}" />

										<h:outputLabel />
										<h:outputLabel />

										<h:outputText value="#{msg['his_rec_menarche']}" />
										<p:inputText style="width:350px"
											value="#{historyBacking.selectedHistoryRecord.menarche}" />

										<h:outputText value="#{msg['his_rec_sexarca']}" />
										<p:inputText style="width:350px"
											value="#{historyBacking.selectedHistoryRecord.sexarca}" />

										<h:outputLabel value="#{msg['his_rec_fur']}" />
										<p:calendar label="#{msg['his_rec_fur']}"
											value="#{historyBacking.selectedHistoryRecord.fur}"
											readonlyInput="false" pattern="dd/MM/yyyy" showOn="button"
											navigator="true" locale="es" yearRange="-100:+0">
											<f:convertDateTime pattern="dd/MM/yyyy" />
										</p:calendar>

										<h:outputText value="#{msg['his_rec_bleeding']}" />
										<p:inputText style="width:350px"
											value="#{historyBacking.selectedHistoryRecord.bleeding}" />

										<h:outputLabel value="#{msg['his_rec_fuc']}" />
										<p:calendar label="#{msg['his_rec_fuc']}"
											value="#{historyBacking.selectedHistoryRecord.fuc}"
											readonlyInput="false" pattern="dd/MM/yyyy" showOn="button"
											navigator="true" locale="es" yearRange="-100:+0">
											<f:convertDateTime pattern="dd/MM/yyyy" />
										</p:calendar>

									</h:panelGrid>
								</p:fieldset>
							</h:panelGrid>

							<p:spacer height="5" />

							<p:fieldset legend="#{msg['his_record_family']}">
								<h:panelGrid columns="2" width="100%"
									columnClasses="width25per,width75per">

									<h:outputText value="#{msg['his_rec_per_hypertension']}" />
									<p:inputTextarea style="width:950px" rows="3"
										value="#{historyBacking.selectedHistoryRecord.hypertensionParent}" />

									<h:outputText value="#{msg['his_rec_epoc']}" />
									<p:inputTextarea style="width:950px" rows="3"
										value="#{historyBacking.selectedHistoryRecord.epocParent}" />

									<h:outputText value="#{msg['his_rec_heart_disease']}" />
									<p:inputTextarea style="width:950px" rows="3"
										value="#{historyBacking.selectedHistoryRecord.heartDiseaseParent}" />

									<h:outputText value="#{msg['his_rec_asthma']}" />
									<p:inputTextarea style="width:950px" rows="3"
										value="#{historyBacking.selectedHistoryRecord.asthmaParent}" />

									<h:outputText value="#{msg['his_rec_acv']}" />
									<p:inputTextarea style="width:950px" rows="3"
										value="#{historyBacking.selectedHistoryRecord.acvParent}" />

									<h:outputText value="#{msg['his_rec_per_cancer']}" />
									<p:inputTextarea style="width:950px" rows="3"
										value="#{historyBacking.selectedHistoryRecord.cancerParent}" />

									<h:outputText value="#{msg['his_rec_per_diabetes']}" />
									<p:inputTextarea style="width:950px" rows="3"
										value="#{historyBacking.selectedHistoryRecord.diabetesParent}" />
								</h:panelGrid>
							</p:fieldset>
						</p:tab>

						<p:tab title="#{msg['his_history_homeopathic']}" id="HOMEOPATHIC"
							rendered="#{historyBacking.rolePrincipal eq 'DOCTOR'}">
							<p:fieldset legend="#{msg['his_homeopathic_biotipology']}">
								<h:panelGrid width="100%">
									<p:selectOneRadio id="options" layout="pageDirection"
										value="#{historyBacking.selectedHistoryHomeopathic.biotypology}">
										<f:selectItem
											itemLabel="#{msg['his_homeopathic_biotipology_1']}"
											itemValue="C" />
										<f:selectItem
											itemLabel="#{msg['his_homeopathic_biotipology_2']}"
											itemValue="S" />
										<f:selectItem
											itemLabel="#{msg['his_homeopathic_biotipology_3']}"
											itemValue="F" />
										<f:selectItem
											itemLabel="#{msg['his_homeopathic_biotipology_4']}"
											itemValue="U" />
									</p:selectOneRadio>
								</h:panelGrid>
							</p:fieldset>

							<p:spacer height="5" />

							<h:panelGrid columns="2" width="100%"
								columnClasses="width25per,width75per">

								<h:outputLabel value="#{msg['his_homeopathic_mental']}" />
								<p:inputTextarea style="width:750px"
									value="#{historyBacking.selectedHistoryHomeopathic.mental}" />

								<h:outputLabel value="#{msg['his_homeopathic_special']}" />
								<p:inputTextarea style="width:750px"
									value="#{historyBacking.selectedHistoryHomeopathic.special}" />

								<h:outputLabel value="#{msg['his_homeopathic_general']}" />
								<p:inputTextarea style="width:750px"
									value="#{historyBacking.selectedHistoryHomeopathic.general}" />

								<h:outputLabel value="#{msg['his_homeopathic_miasm']}" />
								<p:inputTextarea style="width:750px"
									value="#{historyBacking.selectedHistoryHomeopathic.miasm}" />

							</h:panelGrid>
						</p:tab>

						<p:tab title="#{msg['his_history_physique']}" id="PHYSIQUE"
							rendered="#{historyBacking.rolePrincipal ne 'CONSULTANT'}">
							<h:panelGrid columns="4" width="100%"
								columnClasses="width25per,width25per,width25per,width25per">

								<h:outputLabel value="#{msg['his_physique_heart_rate']}" />
								<pe:inputNumber symbol="   puls" symbolPosition="s"
									decimalPlaces="0" style="width:300px" maxValue="200"
									value="#{historyBacking.heartRate}" />

								<h:outputLabel value="#{msg['his_physique_respiratory_rate']}" />
								<pe:inputNumber symbol="   resp/min" symbolPosition="s"
									decimalPlaces="0" style="width:300px" maxValue="70"
									value="#{historyBacking.respiratoryRate}" />

								<h:outputLabel value="#{msg['his_physique_height']}" />
								<pe:inputNumber symbol="   cm" symbolPosition="s"
									decimalPlaces="0" style="width:300px" maxValue="250"
									value="#{historyBacking.height}" />

								<h:outputLabel value="#{msg['his_physique_weight']}" />
								<pe:inputNumber symbol="   kg" symbolPosition="s"
									decimalPlaces="2" style="width:300px" maxValue="999"
									value="#{historyBacking.weight}" />

								<h:outputLabel value="#{msg['his_physique_blood_pressure']}" />
								<p:inputText maxlength="7" style="width:300px"
									value="#{historyBacking.selectedHistoryPhysique.bloodPressure}" />

							</h:panelGrid>

							<h:panelGrid id="pnlIMC" columns="4" width="100%"
								columnClasses="width25per,width25per,width25per,width25per">

								<h:outputLabel value="#{msg['his_physique_imc']}" />
								<pe:inputNumber symbol="  Kg/m2" symbolPosition="s"
									decimalPlaces="2" style="width:300px" maxValue="999"
									value="#{historyBacking.imc}" readonly="true" />

								<h:outputLabel value="#{msg['his_physique_imc']}" />
								<p:inputText value="#{historyBacking.descImc}"
									style="width:300px" />

								<p:commandButton
									actionListener="#{historyBacking.calculateIMCAction}"
									update="pnlIMC" value="#{msg['btn_calculate_imc']}" />

							</h:panelGrid>

							<h:panelGrid columns="2" width="100%"
								columnClasses="width25per,width75per">

								<p:selectBooleanCheckbox
									value="#{historyBacking.selectedHistoryPhysique.generalStateCheck}"
									itemLabel="#{msg['his_physique_general_state']}">
									<p:ajax update="txtPersonal17" />
								</p:selectBooleanCheckbox>
								<p:inputTextarea id="txtPersonal17" style="width:850px" rows="3"
									disabled="#{not historyBacking.selectedHistoryPhysique.generalStateCheck}"
									value="#{historyBacking.selectedHistoryPhysique.generalState}" />

								<p:selectBooleanCheckbox
									value="#{historyBacking.selectedHistoryPhysique.headNeckCheck}"
									itemLabel="#{msg['his_physique_head_neck']}">
									<p:ajax update="txtPersonal18" />
								</p:selectBooleanCheckbox>
								<p:inputTextarea id="txtPersonal18" style="width:850px" rows="3"
									disabled="#{not historyBacking.selectedHistoryPhysique.headNeckCheck}"
									value="#{historyBacking.selectedHistoryPhysique.headNeck}" />

								<p:selectBooleanCheckbox
									value="#{historyBacking.selectedHistoryPhysique.chestCheck}"
									itemLabel="#{msg['his_physique_chest']}">
									<p:ajax update="txtPersonal19" />
								</p:selectBooleanCheckbox>
								<p:inputTextarea id="txtPersonal19" style="width:850px" rows="3"
									disabled="#{not historyBacking.selectedHistoryPhysique.chestCheck}"
									value="#{historyBacking.selectedHistoryPhysique.chest}" />

								<p:selectBooleanCheckbox
									value="#{historyBacking.selectedHistoryPhysique.lungsCheck}"
									itemLabel="#{msg['his_physique_lungs']}">
									<p:ajax update="txtPersonal20" />
								</p:selectBooleanCheckbox>
								<p:inputTextarea id="txtPersonal20" style="width:850px" rows="3"
									disabled="#{not historyBacking.selectedHistoryPhysique.lungsCheck}"
									value="#{historyBacking.selectedHistoryPhysique.lungs}" />

								<p:selectBooleanCheckbox
									value="#{historyBacking.selectedHistoryPhysique.heartCheck}"
									itemLabel="#{msg['his_physique_heart']}">
									<p:ajax update="txtPersonal21" />
								</p:selectBooleanCheckbox>
								<p:inputTextarea id="txtPersonal21" style="width:850px" rows="3"
									disabled="#{not historyBacking.selectedHistoryPhysique.heartCheck}"
									value="#{historyBacking.selectedHistoryPhysique.heart}" />

								<p:selectBooleanCheckbox
									value="#{historyBacking.selectedHistoryPhysique.abdomenCheck}"
									itemLabel="#{msg['his_physique_abdomen']}">
									<p:ajax update="txtPersonal22" />
								</p:selectBooleanCheckbox>
								<p:inputTextarea id="txtPersonal22" style="width:850px" rows="3"
									disabled="#{not historyBacking.selectedHistoryPhysique.abdomenCheck}"
									value="#{historyBacking.selectedHistoryPhysique.abdomen}" />

								<p:selectBooleanCheckbox
									value="#{historyBacking.selectedHistoryPhysique.genitalsCheck}"
									itemLabel="#{msg['his_physique_genitals']}">
									<p:ajax update="txtPersonal23" />
								</p:selectBooleanCheckbox>
								<p:inputTextarea id="txtPersonal23" style="width:850px" rows="3"
									disabled="#{not historyBacking.selectedHistoryPhysique.genitalsCheck}"
									value="#{historyBacking.selectedHistoryPhysique.genitals}" />

								<p:selectBooleanCheckbox
									value="#{historyBacking.selectedHistoryPhysique.osteoCheck}"
									itemLabel="#{msg['his_physique_osteo']}">
									<p:ajax update="txtPersonal24" />
								</p:selectBooleanCheckbox>
								<p:inputTextarea id="txtPersonal24" style="width:850px" rows="3"
									disabled="#{not historyBacking.selectedHistoryPhysique.osteoCheck}"
									value="#{historyBacking.selectedHistoryPhysique.osteo}" />

								<p:selectBooleanCheckbox
									value="#{historyBacking.selectedHistoryPhysique.tipsCheck}"
									itemLabel="#{msg['his_physique_tips']}">
									<p:ajax update="txtPersonal25" />
								</p:selectBooleanCheckbox>
								<p:inputTextarea id="txtPersonal25" style="width:850px" rows="3"
									disabled="#{not historyBacking.selectedHistoryPhysique.tipsCheck}"
									value="#{historyBacking.selectedHistoryPhysique.tips}" />

								<p:selectBooleanCheckbox
									value="#{historyBacking.selectedHistoryPhysique.highlightsCheck}"
									itemLabel="#{msg['his_physique_highlights']}">
									<p:ajax update="txtPersonal26" />
								</p:selectBooleanCheckbox>
								<p:inputTextarea id="txtPersonal26" style="width:850px" rows="3"
									disabled="#{not historyBacking.selectedHistoryPhysique.highlightsCheck}"
									value="#{historyBacking.selectedHistoryPhysique.highlights}" />

								<p:selectBooleanCheckbox
									value="#{historyBacking.selectedHistoryPhysique.skinCheck}"
									itemLabel="#{msg['his_physique_skin']}">
									<p:ajax update="txtPersonal27" />
								</p:selectBooleanCheckbox>
								<p:inputTextarea id="txtPersonal27" style="width:850px" rows="3"
									disabled="#{not historyBacking.selectedHistoryPhysique.skinCheck}"
									value="#{historyBacking.selectedHistoryPhysique.skin}" />

								<h:outputLabel value="#{msg['his_history_obs']}" />
								<p:inputTextarea id="txtPersonal28" style="width:850px" rows="3"
									value="#{historyBacking.selectedHistoryPhysique.obs}" />
							</h:panelGrid>
						</p:tab>

						<p:tab title="#{msg['his_history_organometry']}" id="ORGANOMETRY"
							rendered="#{historyBacking.rolePrincipal ne 'CONSULTANT' and false}">
							<h:panelGrid id="pnlOrganometry" columns="1" width="100%">
								<p:selectBooleanCheckbox
									value="#{historyBacking.selectedHistoryOrganometry.organometryCheck}"
									itemLabel="#{msg['his_organometry_check']}">
									<p:ajax update="pnlOrganometry" />
								</p:selectBooleanCheckbox>
								<h:outputLabel value="#{msg['his_organometry_analysis']}" />
								<p:inputTextarea style="width:950px" rows="3"
									value="#{historyBacking.selectedHistoryOrganometry.organometryAnalysis}" />
							</h:panelGrid>
						</p:tab>

						<p:tab title="#{msg['his_history_iridology']}" id="IRIDOLOGY"
							rendered="#{historyBacking.rolePrincipal eq 'DOCTOR'}">

							<h:panelGrid id="pnlIridology" width="100%" columns="2">
								<h:outputText value="#{msg['his_eye']}" />
								<p:selectOneMenu id="somEye" value="#{historyBacking.eye}"
									style="width:300px;">
									<f:selectItem itemValue="0" itemLabel="#{msg['his_left_eye']}" />
									<f:selectItem itemValue="1" itemLabel="#{msg['his_right_eye']}" />
								</p:selectOneMenu>

								<p:fileUpload value="#{historyBacking.file}" mode="simple" />
								<p:commandButton value="#{msg['his_load']}"
									actionListener="#{historyBacking.fileUploadAction}"
									update=":form:growl pnlIridology" ajax="false"
									process="@this,pnlIridology" />

								<h:outputText
									value="#{msg['pat_type_obs']} #{msg['his_left_eye']}" />
								<p:inputTextarea id="txtLeftEye"
									value="#{historyBacking.selectedHistoryIridology.leftObs}"
									style="width:650px" rows="10"
									label="#{msg['pat_type_obs']} #{msg['his_left_eye']}" />

								<h:outputText value="#{msg['his_left_eye']}" />
								<h:graphicImage id="lighboxLeft" width="100" height="100"
									value="../../pdf/#{historyBacking.leftEye}" />

								<h:outputText
									value="#{msg['pat_type_obs']} #{msg['his_right_eye']}" />
								<p:inputTextarea id="txtRightEye"
									value="#{historyBacking.selectedHistoryIridology.rightObs}"
									style="width:650px" rows="10"
									label="#{msg['pat_type_obs']} #{msg['his_history_iridology']}" />

								<h:outputText value="#{msg['his_right_eye']}" />
								<h:graphicImage id="lighboxRigth" width="100" height="100"
									value="../../pdf/#{historyBacking.rightEye}" />

							</h:panelGrid>

						</p:tab>

						<p:tab title="#{msg['his_consultant']}" id="history_consultant"
							rendered="#{historyBacking.rolePrincipal eq 'CONSULTANT'}">

							<p:inputTextarea id="txtConsultant"
								value="#{historyBacking.selectedHistoryConsultant.obs}"
								style="width:950px" rows="10" label="#{msg['his_consultant']}" />

						</p:tab>

						<p:tab title="#{msg['his_biometric']}" id="BIOMETRIC"
							rendered="#{historyBacking.rolePrincipal eq 'DOCTOR'}">

							<p:inputTextarea id="txtBiometric"
								value="#{historyBacking.selectedHistoryBiometric.test}"
								style="width:950px" rows="10" label="#{msg['his_biometric']}" />

						</p:tab>

						<p:tab title="#{msg['his_history_ip']}" id="IP"
							rendered="#{historyBacking.rolePrincipal eq 'DOCTOR' or historyBacking.rolePrincipal eq 'CONSULTANT'}">

							<h:panelGrid width="100%" columns="2">
								<p:outputLabel value="#{msg['app_rating']}" />
								<p:selectOneMenu
									value="#{historyBacking.currentAppointment.rating}"
									style="width:600px" label="#{msg['app_rating']}">
									<f:selectItem noSelectionOption="true"
										itemLabel="#{msg['glb_default_value']}" />
									<f:selectItem
										itemLabel="A:   Pacientes con patologias simples, tratamientos cortos"
										itemValue="A" />
									<f:selectItem
										itemLabel="AA:  Pacientes con patologias curables, tratamiento mediano plazo"
										itemValue="AA" />
									<f:selectItem
										itemLabel="AAA: Pacientes con patologias cronicas de dificil curación, tratamientos largos"
										itemValue="AAA" />
								</p:selectOneMenu>
							</h:panelGrid>

							<p:fieldset legend="#{msg['his_history_ip']}">

								<p:dataTable id="dtbDiagnosis" var="rec"
									value="#{historyBacking.diagnosisModel}"
									selection="#{historyBacking.selectedsDiagnosis}"
									rowKey="#{rec.id}" paginator="true" rows="15"
									style="width:100%"
									emptyMessage="#{msg['glb_no_records_found']}">

									<p:column selectionMode="multiple" style="width:18px" />

									<p:column headerText="#{msg['cie_code']}">
										<h:outputLabel value="#{rec.crmCie.code}" />
									</p:column>

									<p:column headerText="#{msg['cie_desc']}">
										<h:outputLabel value="#{rec.crmCie.description}" />
									</p:column>´
									
									<p:column headerText="#{msg['cie_diagnosis_type']}">
										<p:selectOneMenu value="#{rec.idDiagnosisType}"
											style="width:250px;">
											<f:selectItems value="#{historyBacking.listDiagnosisType}" />
										</p:selectOneMenu>
									</p:column>

									<p:column style="width:8%">
										<h:panelGrid columns="2" width="100%"
											styleClass="ui-widget-content grid">
											<p:commandButton oncomplete="dlgMedicine.show()"
												update=":form:dialogMedicine" icon="ui-icon-plusthick"
												title="#{msg['btn_select_medication']}"
												action="#{historyBacking.selectMedicationAction}"
												process="@this,dtbDiagnosis">
												<f:setPropertyActionListener value="#{rec}"
													target="#{historyBacking.selectedDiagnosis}" />
											</p:commandButton>
											<p:commandButton oncomplete="dlgPosology.show()"
												update=":form:dialogPosology" icon="ui-icon-comment"
												title="#{msg['btn_add_posology_odo']}"
												action="#{historyBacking.selectPosologyAction}">
												<f:setPropertyActionListener value="#{rec}"
													target="#{historyBacking.selectedDiagnosis}" />
											</p:commandButton>
										</h:panelGrid>
									</p:column>

									<f:facet name="footer">
										<p:commandButton id="btnSelCie" oncomplete="dlgCie.show()"
											value="#{msg['btn_select_diagnosis']}" icon="ui-icon-search"
											actionListener="#{historyBacking.selectDiagnosisAction}"
											update=":form:dialogCie" />
										<p:commandButton oncomplete="dlgMedicationPreview.show()"
											value="#{msg['btn_view_medication']}" icon="ui-icon-search"
											disabled="#{historyBacking.disabledMedication}"
											update=":form:dialogMedicationPreview" />
										<p:commandButton value="#{msg['btn_delete']}"
											disabled="#{historyBacking.disabledDiagnosis}"
											icon="ui-icon-closethick"
											update="dtbDiagnosis :form:accordion:dtbOtherMedication :form:accordion:dtbTherapy :form:accordion:dtbExamns :form:accordion:tblStudyCase"
											actionListener="#{historyBacking.removeDiagnosisAction}" />
									</f:facet>

								</p:dataTable>
							</p:fieldset>

							<p:spacer />

							<p:fieldset legend="#{msg['his_history_other_medicaction']}"
								rendered="#{historyBacking.rolePrincipal eq 'DOCTOR'}">
								<p:dataTable id="dtbOtherMedication" var="rec"
									value="#{historyBacking.otherMedicationModel}"
									selection="#{historyBacking.selectedOtherMedication}"
									rowKey="#{rec.codMaterial}" paginator="true" rows="15"
									style="width:100%"
									emptyMessage="#{msg['glb_no_records_found']}">

									<p:column selectionMode="multiple" style="width:18px" />

									<p:column headerText="#{msg['sal_material_code']}">
										<h:outputLabel value="#{rec.codMaterial}" />
									</p:column>

									<p:column headerText="#{msg['sal_material_descr']}">
										<h:outputLabel value="#{rec.descMaterial}" />
									</p:column>

									<p:column headerText="#{msg['sal_material_amount']}"
										style="width:100px">
										<pe:inputNumber value="#{rec.unit}" symbolPosition="s"
											decimalPlaces="0" style="width:100px" minValue="1"
											maxValue="99" />
									</p:column>

									<p:column headerText="#{msg['cie_grp_diagnosis']}"
										style="width:200px">
										<p:inputTextarea value="#{rec.diagnosis}" rows="3"
											style="width:200px" />
									</p:column>

									<p:column headerText="#{msg['cie_grp_posology']}"
										style="width:200px">
										<p:inputTextarea value="#{rec.posology}" rows="3"
											style="width:200px" />
									</p:column>

									<f:facet name="footer">
										<p:commandButton id="btnSelOtherMedication"
											oncomplete="dlgMedicine.show()" update=":form:dialogMedicine"
											disabled="#{historyBacking.disabledDiagnosis}"
											value="#{msg['btn_select']}" icon="ui-icon-search"
											actionListener="#{historyBacking.selectOtherMedicationAction}" />
										<p:commandButton value="#{msg['btn_delete']}"
											disabled="#{historyBacking.disabledOtherMedication}"
											icon="ui-icon-closethick" update="dtbOtherMedication"
											actionListener="#{historyBacking.removeOtherMedicationAction}" />
									</f:facet>

								</p:dataTable>
							</p:fieldset>

							<p:spacer />

							<p:fieldset legend="#{msg['his_history_therapy']}"
								rendered="#{historyBacking.rolePrincipal eq 'DOCTOR'}">

								<p:dataTable id="dtbTherapy" var="rec"
									value="#{historyBacking.therapyModel}"
									selection="#{historyBacking.selectedTherapy}"
									rowKey="#{rec.codMaterial}" paginator="true" rows="15"
									style="width:100%"
									emptyMessage="#{msg['glb_no_records_found']}">

									<p:column selectionMode="multiple" style="width:18px" />

									<p:column headerText="#{msg['sal_material_code']}">
										<h:outputLabel value="#{rec.codMaterial}" />
									</p:column>

									<p:column headerText="#{msg['sal_material_descr']}">
										<h:outputLabel value="#{rec.descMaterial}" />
									</p:column>

									<p:column headerText="#{msg['sal_material_amount']}"
										style="width:100px">
										<pe:inputNumber value="#{rec.unit}" symbolPosition="s"
											decimalPlaces="0" style="width:100px" minValue="1"
											maxValue="99" />
									</p:column>

									<p:column headerText="#{msg['cie_grp_diagnosis']}"
										style="width:400px">
										<p:inputTextarea value="#{rec.diagnosis}" rows="3"
											style="width:400px" />
									</p:column>

									<f:facet name="footer">
										<p:commandButton id="btnSelTherapy"
											oncomplete="dlgMedicine.show()" update=":form:dialogMedicine"
											disabled="#{historyBacking.disabledDiagnosis}"
											value="#{msg['btn_select']}" icon="ui-icon-search"
											actionListener="#{historyBacking.selectTherapyAction}" />
										<p:commandButton value="#{msg['btn_delete']}"
											disabled="#{historyBacking.disabledTherapy}"
											icon="ui-icon-closethick" update="dtbTherapy"
											actionListener="#{historyBacking.removeTherapyAction}" />
									</f:facet>

								</p:dataTable>
							</p:fieldset>

							<p:spacer />

							<p:fieldset legend="#{msg['his_history_examinations']}"
								rendered="#{historyBacking.rolePrincipal eq 'DOCTOR'}">

								<p:dataTable id="dtbExamns" var="rec"
									value="#{historyBacking.examModel}"
									selection="#{historyBacking.selectedExam}"
									rowKey="#{rec.codMaterial}" paginator="true" rows="15"
									style="width:100%"
									emptyMessage="#{msg['glb_no_records_found']}">

									<p:column selectionMode="multiple" style="width:18px" />

									<p:column headerText="#{msg['sal_material_code']}">
										<h:outputLabel value="#{rec.codMaterial}" />
									</p:column>

									<p:column headerText="#{msg['sal_material_descr']}">
										<h:outputLabel value="#{rec.descMaterial}" />
									</p:column>

									<p:column headerText="#{msg['sal_material_amount']}"
										style="width:100px">
										<pe:inputNumber value="#{rec.unit}" symbolPosition="s"
											decimalPlaces="0" style="width:100px" minValue="1"
											maxValue="99" />
									</p:column>

									<f:facet name="footer">
										<p:commandButton id="btnSelExaminations"
											oncomplete="dlgMedicine.show()" update=":form:dialogMedicine"
											disabled="#{historyBacking.disabledDiagnosis}"
											value="#{msg['btn_select']}" icon="ui-icon-search"
											actionListener="#{historyBacking.selectExamsAction}" />
										<p:commandButton value="#{msg['btn_delete']}"
											disabled="#{historyBacking.disabledExam}"
											icon="ui-icon-closethick" update="dtbExamns"
											actionListener="#{historyBacking.removeExamAction}" />
									</f:facet>

								</p:dataTable>
							</p:fieldset>

							<p:spacer />

							<p:fieldset legend="#{msg['his_management_plan']}"
								rendered="#{historyBacking.rolePrincipal eq 'DOCTOR'}">
								<p:inputTextarea style="width:950px" rows="3"
									value="#{historyBacking.currentAppointment.managementPlan}" />
							</p:fieldset>

							<p:spacer />

							<p:fieldset legend="#{msg['his_recommendations']}"
								rendered="#{historyBacking.rolePrincipal eq 'DOCTOR'}">
								<p:inputTextarea style="width:950px" rows="3"
									value="#{historyBacking.currentAppointment.recommendations}">
									<p:ajax event="blur" update=":form:toolBar" />
								</p:inputTextarea>
							</p:fieldset>

						</p:tab>

						<p:tab title="#{msg['title_case_study']}" id="STUDY_CASE"
							rendered="#{historyBacking.rolePrincipal eq 'DOCTOR' and historyBacking.currentAppointment.crmProcedureDetail.caseStudy}">

							<h:panelGrid width="100%" columns="2">
								<h:outputLabel value="#{msg['his_history_obs']}" />
								<p:inputTextarea id="txtStudyCaseObs" style="width:850px"
									rows="3"
									value="#{historyBacking.currentAppointment.successStories}" />
							</h:panelGrid>

							<p:spacer />

							<p:dataTable id="tblStudyCase" var="rec"
								value="#{historyBacking.listCaseStudy}" paginator="true"
								rows="15" style="width:100%"
								emptyMessage="#{msg['glb_no_records_found']}">
								<p:column headerText="#{msg['cst_patology']}">
									<h:outputLabel value="#{rec.crmCie.description}" />
								</p:column>

								<p:column headerText="#{msg['cst_perc']}">
									<p:selectOneMenu label="#{msg['cst_perc']}"
										value="#{rec.percent}">
										<f:selectItem itemValue="0" itemLabel="0%" />
										<f:selectItem itemValue="10" itemLabel="10%" />
										<f:selectItem itemValue="20" itemLabel="20%" />
										<f:selectItem itemValue="30" itemLabel="30%" />
										<f:selectItem itemValue="40" itemLabel="40%" />
										<f:selectItem itemValue="50" itemLabel="50%" />
										<f:selectItem itemValue="60" itemLabel="60%" />
										<f:selectItem itemValue="70" itemLabel="70%" />
										<f:selectItem itemValue="80" itemLabel="80%" />
										<f:selectItem itemValue="90" itemLabel="90%" />
										<f:selectItem itemValue="100" itemLabel="100%" />
									</p:selectOneMenu>
								</p:column>

							</p:dataTable>

						</p:tab>

						<p:tab title="#{msg['title_appointment']}" id="tab_app_consultant"
							rendered="#{historyBacking.rolePrincipal eq 'CONSULTANT'}">

							<p:toolbar id="toolBarApp" style="width:100%">
								<p:toolbarGroup align="left">
									<p:commandButton value="#{msg['btn_new']}"
										icon="ui-icon-document"
										actionListener="#{historyBacking.newAppAction}"
										process="@this"
										update=":form:accordion:toolBarApp :form:accordion:pnlDetailApp :form:accordion:pnlDetailApp2 :form:accordion:pnlDetailApp3 :form:accordion:pnlDetailApp4" />
									<p:commandButton id="btnSearch"
										value="#{msg['btn_search_app']}" icon="ui-icon-search"
										update=":form:dialog3 :form:accordion:pnlDetailApp4"
										action="#{historyBacking.searchAppointMentAction}"
										disabled="#{historyBacking.disabledSearch or historyBacking.saved}"
										oncomplete="dlg3.show()" />
									<p:commandButton id="btnSaveApp" value="#{msg['btn_save']}"
										icon="ui-icon-disk" update=":form:dialogConfirmation"
										oncomplete="dlgConfirmation.show()"
										action="#{historyBacking.validateAction}"
										disabled="#{historyBacking.saved or historyBacking.selectedCandidate == null}" />
								</p:toolbarGroup>
							</p:toolbar>

							<p:spacer height="10" />

							<h:panelGrid id="pnlDetailApp" columns="2" width="100%"
								columnClasses="width25per,width75per">
								<h:outputLabel value="#{msg['app_branch']}" />
								<p:selectOneMenu style="width:700px" filter="true"
									filterMatchMode="contains" panelStyle="width:700px"
									value="#{historyBacking.idBranch}">
									<f:selectItems value="#{historyBacking.listBranchByConsultant}" />
									<p:ajax update="tab_app_consultant"
										listener="#{historyBacking.handleBranchChange}" />
								</p:selectOneMenu>

								<h:outputLabel value="#{msg['app_procedure']}" />
								<p:selectOneMenu id="selProcedure" style="width:700px"
									value="#{historyBacking.idProcedureDetail}"
									filterMatchMode="contains" panelStyle="width:700px">
									<f:selectItems value="#{historyBacking.listProcedureDetail}" />
									<p:ajax update="tab_app_consultant"
										listener="#{historyBacking.handleProcedureDetailChange}" />
								</p:selectOneMenu>

								<h:outputLabel value="#{msg['app_seller_group']}" />
								<p:selectOneMenu style="width:700px"
									value="#{historyBacking.selectedWSGroupSellers}"
									filterMatchMode="contains" panelStyle="width:700px">
									<f:selectItems value="#{historyBacking.listWSGroupSellers}" />
								</p:selectOneMenu>

							</h:panelGrid>

							<h:panelGrid id="pnlDetailApp2" columns="2" width="100%"
								columnClasses="width25per,width75per">

								<h:outputLabel id="lblCurrentDate" value="#{msg['app_date']}" />
								<h:panelGrid columns="2">
									<p:calendar value="#{historyBacking.currentDate}"
										id="calCurrentDate" showOn="button" navigator="true"
										pattern="dd/MM/yyyy" readonlyInput="true"
										mindate="#{historyBacking.today}" locale="es">
										<p:ajax event="dateSelect"
											listener="#{historyBacking.handleDateSelect}"
											update="lblMessageDate" />
									</p:calendar>
									<h:outputLabel id="lblMessageDate" style="font-weight:bold;"
										value="#{historyBacking.infoMessageDate}" />
								</h:panelGrid>

								<h:outputLabel value="#{msg['app_num']}" />
								<p:selectOneMenu style="width:700px"
									value="#{historyBacking.appointmentsNumber}">
									<f:selectItem itemLabel="#{msg['app_first_10_app']}"
										itemValue="10" />
									<f:selectItem itemLabel="#{msg['app_first_20_app']}"
										itemValue="20" />
									<f:selectItem itemLabel="#{msg['app_first_30_app']}"
										itemValue="30" />
									<f:selectItem itemLabel="#{msg['app_first_50_app']}"
										itemValue="50" />
									<f:selectItem itemLabel="#{msg['app_first_70_app']}"
										itemValue="70" />
								</p:selectOneMenu>

							</h:panelGrid>

							<h:panelGrid id="pnlDetailApp3" columns="2" width="100%"
								columnClasses="width25per,width75per">
								<h:outputLabel value="#{msg['app_obs']}" />
								<p:inputTextarea value="#{historyBacking.selectedApp.obs}"
									style="width:700px" rows="3" />
							</h:panelGrid>

							<h:panelGrid id="pnlDetailApp4" width="100%">
								<p:spacer height="5" />
								<h:outputLabel
									style="text-align:center;font-size:large;font-weight:bold;"
									value="#{historyBacking.detSelectedCandidate}" />

							</h:panelGrid>
						</p:tab>

					</p:accordionPanel>

					<h:panelGrid id="pnlHistorial"
						rendered="#{historyBacking.modeHistorial}" width="100%">

						<ui:include src="historialNew.xhtml">
							<ui:param name="prefix" value="pnlHistorial" />
						</ui:include>

					</h:panelGrid>

				</h:panelGrid>

				<p:dialog id="dialogHistorial" widgetVar="dlgHistorial"
					resizable="true" draggable="true" width="1000" height="600"
					header="#{msg['btn_view_history']}">

					<ui:include src="historialNew.xhtml">
						<ui:param name="prefix" value="dlgHistorial" />
					</ui:include>

				</p:dialog>

				<p:dialog header="#{msg['his_history_ip']}" widgetVar="dlgCie"
					resizable="false" id="dialogCie" showEffect="fade"
					hideEffect="explode" modal="true" width="600">

					<p:defaultCommand target="btnSearchCIE" />

					<h:panelGrid columns="2" width="100%">
						<h:outputLabel value="#{msg['cie_desc']}" />
						<p:inputText value="#{historyBacking.descCIE}" style="width:300px" />
					</h:panelGrid>

					<p:spacer />

					<h:panelGrid columns="2">
						<p:commandButton id="btnSearchCIE" value="#{msg['btn_search']}"
							process="@this,dialogCie" icon="ui-icon-search"
							update="pnlTable3 recordTable3 btnAddCIE"
							actionListener="#{historyBacking.searchCIEAction}" />
						<p:commandButton id="btnAddCIE" value="#{msg['btn_add']}"
							icon="ui-icon-plusthick" process="@this,dialogCie"
							update="recordTable3 :form:accordion:dtbDiagnosis :form:accordion:dtbTherapy :form:accordion:dtbOtherMedication :form:accordion:dtbExamns :form:accordion:tblStudyCase"
							actionListener="#{historyBacking.addCieAction}"
							disabled="#{historyBacking.disabledAddCie}" />
					</h:panelGrid>


					<p:spacer height="10" />

					<p:scrollPanel id="pnlTable3" style="width:99%;height:380px">
						<p:dataTable id="recordTable3" var="rec"
							value="#{historyBacking.cieModel}" rowKey="#{rec.id}"
							selection="#{historyBacking.selectedCie}" paginator="true"
							rows="15" style="width:100%"
							emptyMessage="#{msg['glb_no_records_found']}">

							<p:column selectionMode="single" style="width:18px" />

							<p:column headerText="#{msg['cie_code']}">
								<h:outputLabel value="#{rec.code}" />
							</p:column>

							<p:column headerText="#{msg['cie_desc']}">
								<h:outputLabel value="#{rec.description}" />
							</p:column>

						</p:dataTable>
					</p:scrollPanel>

				</p:dialog>

				<p:dialog header="#{historyBacking.titleMedication}"
					widgetVar="dlgMedicine" resizable="false" id="dialogMedicine"
					showEffect="fade" hideEffect="explode" modal="true" width="600">

					<p:defaultCommand target="btnMedicationSearch" />

					<h:panelGrid columns="2" width="100%">
						<h:outputLabel value="#{msg['cie_desc']}" />
						<p:inputText value="#{historyBacking.descMaterial}"
							style="width:300px" />

						<h:outputLabel value="#{msg['sal_material_amount']}" />
						<pe:inputNumber value="#{historyBacking.amount}" minValue="1"
							maxValue="99" />
					</h:panelGrid>

					<p:spacer />

					<h:panelGrid columns="2">
						<p:commandButton id="btnMedicationSearch"
							value="#{msg['btn_search']}" icon="ui-icon-search"
							process="@this, dialogMedicine"
							update="pnlTable4 recordTable4 btnAddMaterial"
							actionListener="#{historyBacking.searchMaterialAction}" />
						<p:commandButton id="btnAddMaterial" value="#{msg['btn_add']}"
							icon="ui-icon-plusthick" process="@this, dialogMedicine"
							update="recordTable4 :form:accordion:dtbDiagnosis :form:accordion:dtbOtherMedication :form:accordion:dtbTherapy :form:accordion:dtbExamns"
							actionListener="#{historyBacking.addMaterialAction}"
							disabled="#{historyBacking.disabledAddMaterial}" />
					</h:panelGrid>

					<p:spacer height="10" />

					<p:scrollPanel id="pnlTable4" style="width:99%;height:380px">
						<p:dataTable id="recordTable4" var="rec"
							value="#{historyBacking.materialModel}" rowKey="#{rec.code}"
							selection="#{historyBacking.selectedMaterial}" paginator="true"
							rows="15" style="width:100%"
							emptyMessage="#{msg['glb_no_records_found']}">

							<p:column selectionMode="single" style="width:18px" />

							<p:column headerText="#{msg['cie_code']}">
								<h:outputLabel value="#{rec.code}" />
							</p:column>

							<p:column headerText="#{msg['cie_desc']}">
								<h:outputLabel value="#{rec.name}" />
							</p:column>

						</p:dataTable>
					</p:scrollPanel>

				</p:dialog>

				<p:dialog header="#{msg['btn_add_posology']}"
					widgetVar="dlgPosology" resizable="false" id="dialogPosology"
					showEffect="fade" hideEffect="explode" modal="true" width="610">

					<h:panelGrid width="100%">
						<p:inputTextarea rows="7" style="width:560px"
							value="#{historyBacking.posology}" />

						<p:commandButton value="#{msg['btn_save']}"
							update=":form:dialogPosology"
							action="#{historyBacking.savePosologyAction}"
							oncomplete="dlgPosology.hide()" />
					</h:panelGrid>

				</p:dialog>

				<p:dialog header="#{msg['cie_grp_medication']}"
					widgetVar="dlgMedicationPreview" resizable="false"
					id="dialogMedicationPreview" showEffect="fade" hideEffect="explode"
					modal="true" width="800">

					<p:scrollPanel style="width:780px;height:600px;">
						<p:dataTable id="dtbMedication" var="rec"
							value="#{historyBacking.medicationModel}"
							selection="#{historyBacking.selectedMedication}"
							rowKey="#{rec.id}" paginator="true" rows="12" style="width:100%"
							emptyMessage="#{msg['glb_no_records_found']}" editable="true"
							editMode="cell">

							<p:column selectionMode="multiple" style="width:18px" />

							<p:column headerText="#{msg['cie_grp_diagnosis']}">
								<h:outputLabel value="#{rec.crmCie.description}" />
							</p:column>

							<p:column headerText="#{msg['sal_material_code']}">
								<h:outputLabel value="#{rec.codMaterial}" />
							</p:column>

							<p:column headerText="#{msg['sal_material_descr']}">
								<h:outputLabel value="#{rec.descMaterial}" />
							</p:column>

							<p:column headerText="#{msg['sal_material_amount']}"
								style="width:100px">
								<p:cellEditor>
									<f:facet name="output">
										<pe:inputNumber value="#{rec.unit}" symbolPosition="s"
											decimalPlaces="0" style="width:100px" minValue="1"
											maxValue="99" />
									</f:facet>
									<f:facet name="input">
										<pe:inputNumber value="#{rec.unit}" symbolPosition="s"
											decimalPlaces="0" style="width:100px" minValue="1"
											maxValue="99" />
									</f:facet>
								</p:cellEditor>
							</p:column>

							<p:column headerText="#{msg['cie_grp_posology']}">
								<p:cellEditor>
									<f:facet name="output">
										<h:inputTextarea id="txtPosologyOut" value="#{rec.posology}"
											rows="5" />
									</f:facet>
									<f:facet name="input">
										<h:inputTextarea id="txtPosologyIn" value="#{rec.posology}"
											rows="5" />
									</f:facet>
								</p:cellEditor>
							</p:column>

							<f:facet name="footer">
								<p:commandButton value="#{msg['btn_delete']}"
									disabled="#{historyBacking.disabledMedication}"
									icon="ui-icon-closethick" update="dtbMedication"
									process="@this, :form:dialogMedicationPreview"
									actionListener="#{historyBacking.removeMedicationAction}" />
							</f:facet>

						</p:dataTable>
					</p:scrollPanel>
				</p:dialog>

				<p:confirmDialog id="confirmDialog" message="#{msg['glb_question']}"
					header="#{msg['btn_close_appointment']}" severity="alert"
					widgetVar="confirmation">

					<p:commandButton id="confirm" value="#{msg['btn_ok']}"
						oncomplete="confirmation.hide()" process="@this,accordion"
						update=":form:accordion :form:growl :form:toolBar"
						actionListener="#{historyBacking.closeAppointmentAction}" />
					<p:commandButton id="decline" value="#{msg['btn_cancel']}"
						onclick="confirmation.hide()" type="button" />

				</p:confirmDialog>

				<p:dialog header="#{msg['sal_patient']}" widgetVar="dlgPatient"
					resizable="false" id="dialogPatient" showEffect="fade"
					hideEffect="explode" modal="true" width="600">

					<p:defaultCommand target="btnSearcPatient" />

					<h:panelGrid columns="2" width="100%">
						<h:outputLabel value="#{msg['his_type']}" />
						<p:selectOneMenu style="width:350px"
							value="#{historyBacking.typeHistory}">
							<f:selectItem itemLabel="#{msg['his_medical_type']}"
								itemValue="MEDICAL" />
							<f:selectItem itemLabel="#{msg['his_odontology_type']}"
								itemValue="ODONTOLOGY" />
						</p:selectOneMenu>
					</h:panelGrid>

					<h:panelGrid columns="1" width="100%">
						<h:outputLabel
							value="Digite #{msg['sal_key_press_doc']} ó #{msg['sal_key_press_nom']}" />
						<p:inputText value="#{historyBacking.docPatient}"
							style="width:100%" />
					</h:panelGrid>

					<p:spacer height="10" />

					<h:panelGrid columns="2">
						<p:commandButton id="btnSearcPatient" value="#{msg['btn_search']}"
							icon="ui-icon-search" process="dialogPatient"
							update="pnlTable2 recordTable2 btnAddPatient"
							action="#{historyBacking.searchPatientNewAction}" />
						<p:commandButton id="btnAddPatient" value="#{msg['btn_add']}"
							icon="ui-icon-plusthick" update=":form" process="dialogPatient"
							actionListener="#{historyBacking.showHistorialAction}"
							disabled="#{historyBacking.disabledAddPatient}"
							oncomplete="dlgPatient.hide()" />
					</h:panelGrid>

					<p:spacer height="10" />

					<p:scrollPanel id="pnlTable2" style="width:580px;height:300px">
						<p:dataTable id="recordTable2" var="rec"
							value="#{historyBacking.patientModel}" rowKey="#{rec.id}"
							selection="#{historyBacking.selectedPatientTemp}"
							paginator="true" rows="15" style="width:570px"
							emptyMessage="#{msg['glb_no_records_found']}">

							<p:column selectionMode="single" style="width:18px" />

							<p:column headerText="#{msg['pat_sap_code']}">
								<h:outputLabel value="#{rec.codeSap}" />
							</p:column>

							<p:column headerText="#{msg['pat_names']}">
								<h:outputLabel value="#{rec.names}" />
							</p:column>

						</p:dataTable>
					</p:scrollPanel>

				</p:dialog>

				<p:dialog header="#{msg['his_history_note']}" widgetVar="dlgNote"
					resizable="false" id="dialogNote" showEffect="fade"
					hideEffect="explode" modal="true" width="600" dynamic="true">

					<h:panelGrid id="pnlNote" columns="2" width="100%">
						<p:outputLabel value="#{msg['his_history_note_type']}"
							for="selMenuType" />
						<p:selectOneMenu id="selMenuType"
							label="#{msg['his_history_note_type']}"
							value="#{historyBacking.noteType}" style="width:400px;">

							<f:selectItem itemValue="MEDICO"
								itemDisabled="#{historyBacking.rolePrincipal ne 'DOCTOR'}"
								itemLabel="#{msg['his_history_note_doctor']}" />
							<f:selectItem itemValue="SOPORTE"
								itemDisabled="#{historyBacking.rolePrincipal ne 'DOCTOR'}"
								itemLabel="#{msg['his_history_note_support']}" />
							<f:selectItem itemValue="ENFERMERA"
								itemDisabled="#{historyBacking.rolePrincipal eq 'DOCTOR'}"
								itemLabel="#{msg['his_history_note_nurse']}" />
							<f:selectItem itemValue="REMISION"
								itemDisabled="#{historyBacking.rolePrincipal ne 'DOCTOR'}"
								itemLabel="#{msg['his_history_note_remission']}" />
							<f:selectItem itemValue="TERAPIA"
								itemDisabled="#{historyBacking.rolePrincipal ne 'DOCTOR'}"
								itemLabel="#{msg['his_history_note_therapy']}" />

							<p:ajax update="pnlNote" process="@this"
								listener="#{historyBacking.handleNoteTypeChange}" />

						</p:selectOneMenu>

						<p:outputLabel value="#{msg['his_history_therapy']}"
							for="selTherapy"
							rendered="#{historyBacking.noteType eq 'ENFERMERA' or historyBacking.noteType eq 'TERAPIA'}" />
						<p:selectOneMenu id="selTherapy"
							label="#{msg['his_history_therapy']}"
							value="#{historyBacking.idNoteTherapy}" style="width:400px;"
							rendered="#{historyBacking.noteType eq 'ENFERMERA' or historyBacking.noteType eq 'TERAPIA'}">

							<f:selectItems value="#{historyBacking.listNoteTherapyItem}" />

							<p:ajax update="pnlNote" process="@this"
								listener="#{historyBacking.handleTherapyChange}" />
						</p:selectOneMenu>

						<h:outputLabel value="#{msg['his_history_note']}" />
						<p:inputTextarea id="txtNote" rows="5" style="width:400px;"
							value="#{historyBacking.noteDoctor}" required="false"
							label="#{msg['his_history_note']}"
							rendered="#{not historyBacking.autoNote}" />
						<p:panelGrid id="pnlAutoNote"
							binding="#{historyBacking.containerComponent}"
							rendered="#{historyBacking.autoNote}" style="width:400px;" />

						<p:commandButton value="#{msg['btn_add']}" process="@this,pnlNote"
							actionListener="#{historyBacking.saveNoteAction}"
							update=":form:growl pnlNote :form:pnlHistorial_tabview:tblNotes :form:dlgHistorial_tabview:tblNotes"
							oncomplete="handleNoteComplete(xhr, status, args)" />
					</h:panelGrid>

				</p:dialog>

				<p:dialog header="#{msg['his_history_consent']}"
					widgetVar="dlgConsent" resizable="false" id="dialogConsent"
					showEffect="fade" hideEffect="explode" modal="true" width="600"
					dynamic="true">

					<h:panelGrid id="pnlConsent" columns="2" width="100%">
						<h:outputLabel value="#{msg['con_date_informed']}" />
						<p:calendar value="#{historyBacking.consentDate}" required="true"
							id="calConsentDate" showOn="button" navigator="true"
							pattern="dd/MM/yyyy" readonlyInput="false" locale="es"
							label="#{msg['con_date_informed']}"
							maxdate="#{historyBacking.today}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</p:calendar>

						<h:outputLabel value="#{msg['con_consent']}" />
						<p:fileUpload cancelLabel="#{msg['file_cancel']}"
							invalidFileMessage="#{msg['file_invalid_size']}"
							uploadLabel="#{msg['file_upload']}" label="#{msg['file_choose']}"
							fileUploadListener="#{uploadBacking.uploadFile}" mode="advanced"
							sizeLimit="1258292" auto="true"
							allowTypes="/(\.|\/)(jpe?g|png)$/" update="pnlPreview" />

						<p:commandButton value="#{msg['btn_add']}"
							process="@this,pnlConsent"
							actionListener="#{historyBacking.saveConsentAction}"
							update=":form:growl pnlNote :form:pnlHistorial_tabview:tblConsent :form:dlgHistorial_tabview:tblConsent"
							oncomplete="handleConsentComplete(xhr, status, args)" />
					</h:panelGrid>

					<p:spacer />

					<p:panel id="pnlPreview" header="#{msg['title_preview']}">
						<p:graphicImage id="currentImage"
							value="#{uploadBacking.uploadedFileAsStream}" width="550"
							height="300" cache="false" />
					</p:panel>

				</p:dialog>

				<p:dialog header="#{msg['app_avalaible']}" widgetVar="dlg3"
					resizable="false" id="dialog3" showEffect="fade"
					hideEffect="explode" modal="true" width="700">

					<h:outputText value="#{historyBacking.infoMessage}"
						style="font-size:large;font-weight:bold;" />

					<p:spacer rendered="#{historyBacking.infoMessage ne null}" />

					<p:dataTable id="selectedTableApp" var="rec"
						value="#{historyBacking.modelCandidate}" rowKey="#{rec.id}"
						style="width:100%"
						selection="#{historyBacking.selectedCandidateTemp}"
						paginator="true" rows="10"
						emptyMessage="#{msg['glb_no_records_found']}">

						<p:column selectionMode="single" style="width:18px" />

						<p:column headerText="#{msg['app_date']}">
							<h:outputLabel value="#{rec.startDate}">
								<f:convertDateTime pattern="dd/MM/yyyy" />
							</h:outputLabel>
						</p:column>

						<p:column headerText="#{msg['app_start_hour']}">
							<h:outputLabel value="#{rec.startDate}">
								<f:convertDateTime pattern="HH:mm" />
							</h:outputLabel>
						</p:column>

						<p:column headerText="#{msg['app_end_hour']}">
							<h:outputLabel value="#{rec.endDate}">
								<f:convertDateTime pattern="HH:mm" />
							</h:outputLabel>
						</p:column>

						<p:column headerText="#{msg['app_doctor']}" rendered="false">
							<h:outputLabel value="#{rec.doctor.names}" />
						</p:column>

						<f:facet name="footer">
							<p:commandButton value="#{msg['btn_add_app']}"
								action="#{historyBacking.addAppointmentAction}"
								oncomplete="dlg3.hide()"
								update=":form:accordion:pnlDetailApp4 :form:accordion:toolBarApp" />
						</f:facet>

					</p:dataTable>

				</p:dialog>

				<p:dialog id="dialogConfirmation" modal="true"
					header="#{msg['title_appointment']}" severity="alert"
					widgetVar="dlgConfirmation" width="450" resizable="false">

					<h:outputLabel value="#{msg['glb_question']}"
						rendered="#{historyBacking.validate}" />

					<h:panelGrid width="100%">
						<h:outputLabel value="#{historyBacking.infoMessage}"
							rendered="#{not historyBacking.validate}"
							style="text-align:center;font-size:large;font-weight:bold;" />
						<p:spacer height="5" rendered="#{not historyBacking.validate}" />
						<h:outputLabel value="#{historyBacking.detSelectedCandidate}"
							rendered="#{historyBacking.validate}"
							style="text-align:center;font-weight:bold;" />
					</h:panelGrid>

					<f:facet name="footer">

						<p:commandButton value="#{msg['btn_ok']}"
							oncomplete="dlgConfirmation.hide();dlg.show();"
							update=":form:toolBar conffirmation"
							action="#{historyBacking.saveAppAction}"
							rendered="#{historyBacking.validate}">
							<f:param name="APP_TYPE" value="ORDINARY" />
						</p:commandButton>

						<p:commandButton rendered="#{historyBacking.validate}"
							value="#{msg['btn_cancel']}" onclick="dlgConfirmation.hide()"
							type="button" />

					</f:facet>

				</p:dialog>

				<p:dialog id="conffirmation" widgetVar="dlg"
					header="#{msg['app_title']}" width="450" resizable="false"
					showEffect="clip" hideEffect="clip" modal="true">

					<p:ajax event="close"
						update=":form:accordion:toolBarApp :form:accordion:pnlDetailApp :form:accordion:pnlDetailApp2 :form:accordion:pnlDetailApp3 :form:accordion:pnlDetailApp4"
						listener="#{historyBacking.handleClose}" />

					<h:panelGrid width="100%">
						<h:outputLabel value="#{historyBacking.infoMessage}"
							style="text-align:center;font-size:large;font-weight:bold;" />
						<p:spacer height="5" rendered="#{historyBacking.saved}" />
						<h:outputLabel value="#{historyBacking.detSelectedCandidate}"
							rendered="#{historyBacking.saved}"
							style="text-align:center;font-size:large;font-weight:bold;" />
					</h:panelGrid>

				</p:dialog>

				<p:confirmDialog global="true" showEffect="fade"
					hideEffect="explode">
					<p:commandButton value="Yes" type="button"
						styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
					<p:commandButton value="No" type="button"
						styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
				</p:confirmDialog>

			</p:panel>

		</h:form>

		<script type="text/javascript">
			function handleNoteComplete(xhr, status, args) {
				if (args.validationFailed || !args.saved) {
					jQuery('dialogNote').effect("shake", {
						times : 3
					}, 100);
				} else {
					dlgNote.hide();
				}
			}

			function handleConsentComplete(xhr, status, args) {
				if (args.validationFailed || !args.saved) {
					jQuery('dialogConsent').effect("shake", {
						times : 3
					}, 100);
				} else {
					dlgConsent.hide();
				}
			}

			function start() {
				statusDialog.show();
			}

			function stop() {
				statusDialog.hide();
			}
		</script>

	</ui:define>
</ui:composition>
</html>